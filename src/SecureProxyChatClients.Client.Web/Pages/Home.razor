@page "/"
@using SecureProxyChatClients.Client.Web.Services
@inject StoryStateService StoryState
@inject AuthState AuthState

<PageTitle>LoreEngine — Interactive Fiction</PageTitle>

<div data-testid="home-container">
    <div class="text-center mb-4">
        <pre class="ascii-art" style="display: inline-block; text-align: left; font-size: 0.6rem;">
    ╦   ╔═╗╦═╗╔═╗╔═╗╔╗╔╔═╗╦╔╗╔╔═╗
    ║   ║ ║╠╦╝║╣ ║╣ ║║║║ ╦║║║║║╣ 
    ╩═╝ ╚═╝╩╚═╚═╝╚═╝╝╚╝╚═╝╩╝╚╝╚═╝
        ⚔️  Interactive Fiction Engine  ⚔️
        </pre>
        <h1>Your AI Writing Team. Your Story. Your Rules.</h1>
        <p class="lead" style="max-width: 600px; margin: 0 auto;">
            Explore dangerous worlds, outwit cunning NPCs, and forge your own legend — 
            all powered by AI agents through a secure proxy.
        </p>
    </div>

    <hr class="lore-separator" />

    @if (!AuthState.IsAuthenticated)
    {
        <div class="auth-container mb-4" style="max-width: 100%; text-align: center;">
            <h4 class="auth-title">🔑 Begin Your Journey</h4>
            <p class="auth-subtitle">Create an account or sign in to start your adventure</p>
            <div class="d-flex gap-3 justify-content-center">
                <a href="/register" class="btn btn-primary">📝 Register</a>
                <a href="/login" class="btn btn-outline-primary">🔑 Login</a>
            </div>
        </div>
    }

    <div class="row g-4 mt-2">
        <div class="col-md-6">
            <div class="card h-100" style="border-left: 3px solid var(--lore-gold);">
                <div class="card-body">
                    <div style="font-size: 2em;">⚔️</div>
                    <h4 style="font-family: var(--font-display); color: var(--lore-gold);">Play Adventure</h4>
                    <p>Become the hero. Create your character, explore the world, battle monsters, and discover secrets. 
                       The AI Dungeon Master responds to your every move.</p>
                    <ul style="color: var(--lore-text-dim); font-size: 0.9rem;">
                        <li>Server-enforced dice rolls & game state</li>
                        <li>Inventory, health, and XP tracking</li>
                        <li>NPCs with hidden secrets</li>
                        <li>ASCII art scene descriptions</li>
                    </ul>
                    @if (AuthState.IsAuthenticated)
                    {
                        <a href="/play" class="btn btn-primary" data-testid="link-play">⚔️ Begin Adventure</a>
                    }
                    else
                    {
                        <a href="/login" class="btn btn-primary" data-testid="link-play">🔑 Login to Play</a>
                    }
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card h-100" style="border-left: 3px solid var(--lore-purple);">
                <div class="card-body">
                    <div style="font-size: 2em;">🎭</div>
                    <h4 style="font-family: var(--font-display); color: var(--lore-purple);">Create Story</h4>
                    <p>Build a story from scratch with your AI writing team. Choose a genre, set world rules, 
                       and watch the Writer's Room debate your ideas.</p>
                    <ul style="color: var(--lore-text-dim); font-size: 0.9rem;">
                        <li>4-step guided story creation</li>
                        <li>3 AI agents: Storyteller, Critic, Archivist</li>
                        <li>Genre & world rule customization</li>
                        <li>Scene-by-scene building</li>
                    </ul>
                    @if (AuthState.IsAuthenticated)
                    {
                        <a href="/create-story" class="btn btn-outline-primary" data-testid="link-create-story">🎭 Create Story</a>
                    }
                    else
                    {
                        <a href="/login" class="btn btn-outline-primary" data-testid="link-create-story">🔑 Login to Create</a>
                    }
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card h-100" style="border-left: 3px solid var(--agent-critic);">
                <div class="card-body">
                    <div style="font-size: 2em;">📝</div>
                    <h4 style="font-family: var(--font-display); color: var(--agent-critic);">Writer's Room</h4>
                    <p>Pitch ideas directly to your AI writing team and watch them brainstorm, 
                       critique, and refine your concepts in real-time.</p>
                    @if (AuthState.IsAuthenticated)
                    {
                        <a href="/writers-room" class="btn btn-outline-primary" data-testid="link-writers-room">📝 Open Room</a>
                    }
                    else
                    {
                        <a href="/login" class="btn btn-outline-primary" data-testid="link-writers-room">🔑 Login Required</a>
                    }
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card h-100" style="border-left: 3px solid var(--lore-cyan);">
                <div class="card-body">
                    <div style="font-size: 2em;">💬</div>
                    <h4 style="font-family: var(--font-display); color: var(--lore-cyan);">Secure Chat</h4>
                    <p>Direct chat with AI through the secure proxy. Full tool calling, 
                       streaming, and session persistence.</p>
                    @if (AuthState.IsAuthenticated)
                    {
                        <a href="/chat" class="btn btn-outline-primary" data-testid="link-chat">💬 Open Chat</a>
                    }
                    else
                    {
                        <a href="/login" class="btn btn-outline-primary" data-testid="link-chat">🔑 Login Required</a>
                    }
                </div>
            </div>
        </div>
    </div>

    @if (StoryState.Scenes.Count > 0 || StoryState.Characters.Count > 0)
    {
        <div class="card mt-4" data-testid="home-stats">
            <div class="card-header">📊 Quick Stats</div>
            <div class="card-body">
                <div class="d-flex gap-4">
                    <div><strong>@StoryState.Scenes.Count</strong> Scene(s)</div>
                    <div><strong>@StoryState.Characters.Count</strong> Character(s)</div>
                    <div><strong>@StoryState.WorldRules.Count</strong> World Rule(s)</div>
                    <div><strong>@StoryState.Connections.Count</strong> Connection(s)</div>
                </div>
            </div>
        </div>
    }

    <hr class="lore-separator" />

    <div class="text-center mt-3" style="color: var(--lore-text-dim); font-size: 0.85rem;">
        <p>🔒 Secure Augmenting Proxy Reference Sample — .NET 10 · Aspire · MEAI · Blazor WASM</p>
    </div>
</div>

@code {
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await AuthState.InitializeAsync();
            StateHasChanged();
        }
    }
}
